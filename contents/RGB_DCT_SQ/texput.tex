% Emacs, this is -*-latex-*-

\input{../../definitions}
\title{\SM{} - Removing $\text{RGB}$ Redundancy with the DCT (Discrete Cosine Transform)}

\maketitle

\tableofcontents

\section{Description of the task}
%{{{

This task explains how the RD
tradeoff~\cite{vruiz__information_theory} can be
improved\footnote{Compared to the coding algorithm in which only Q+PNG
is applied to each color component, directly.} when the color
redundancy~\cite{vruiz__visual_redundancy} is exploited. The idea is
to concentrate, as much as possible, the visual information in a
smaller number of color channels\footnote{Also refered by color
components.}. In the case of the DCT applied to the color domain, most
of the energy is ``concentrated'' in the first subband($\text{DCT}_0$)
which basically represents the
\href{https://en.wikipedia.org/wiki/Luminance}{luminance} of the
image.

%}}}


\section{Color decorrelation with the DCT}
%{{{ 

One way of achieving the decorrelation in the $\text{RGB}$ domain is
to use
\href{https://vicente-gonzalez-ruiz.github.io/transform_coding/}{Transform
  Coding}~\cite{vruiz__transform_coding} applied between the color
components to concentrate information of the image in a small set of
coefficients, that after a quantization can be compressed with a
better RD performance~\cite{vruiz__information_theory}. For this task
we will use the DCT~\cite{vruiz__DCT}. To measure the amount of energy
compaction we can quantize the coefficients (the output of the forward
transform) and to entropy encode~\cite{vruiz__information_theory} the
result.

After using the DCT we will obtain a new ``image'' in which the
channels are called subbands~\cite{vruiz__transform_coding} and
where there are three coefficients $\text{DCT}^0_{i,j}$,
$\text{DCT}^1_{i,j}$, and $\text{DCT}^2_{i,j}$, per ``pixel''
$\mathbf{I}_{i,j}$. Notice that the number of coefficients in a
subband $\text{DCT}^s$ is the same that the number of pixels in
$\mathbf{I}$ (or the number of components in a channel
$\mathbf{I}^c$).

Notice that the DCT is orthogonal and therefore, the contributions of
the subbands (to the quality of the reconstructed image) are
independent and therefore, additive. Because the DCT is also
orthonormal, we can measure the distortion in both, the image and the
transform domain.

\section{Scalar quantization in the ($\text{DCT}_0,\text{DCT}_1,\text{DCT}_2$) domain}
%{{{

The DCT is orthonormal, and thereore, the distortion can be measured
directly in the transform domain. This means that we can treat the DCT
coefficients as if would be pixels. Therefore, an optimal algorithm
for RDO~\cite{vruiz__information_theory} is:

\begin{enumerate}
\item Find the RD curve for each subband. We will use the same
  quantization steps for all the subbands. This action generates three
  curves.
\item Join all the RD points in a single list and sort it by the slope
  of the
  points~\cite{vruiz__information_theory}. Track\footnote{Storing with
  the point the combination subband index and quantization step used
  for each point.} the quantization steps used for each point.
\item Use the quantization patters described by the points of the
  sorted list to obtain the definitive RD curve. Notice that, since
  the DCT is orthonormal, we could estimate accurately the distortion
  in the definitive curve using directly the distortions of the
  subbands.
\end{enumerate}

Notice that the points that satisfy that
\begin{equation}
  \mathbf{\Delta}_0 = \mathbf{\Delta}_1 = \mathbf{\Delta}_2
  \label{eq:deltas}
\end{equation}
should belong to the definitive RD curve and should describe also the
convex hull of the curve. There is not guarantee that the rest of
points in which the Eq.~\eqref{eq:deltas} is not true will belong to
the convex hull (although they could be used to perform a finer
rate-control).

This algorithm has been implemented in this \href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/contents/RGB_DCT/RGB_DCT.ipynb}{notebook}.

\section{Ablation study}
The improvement resulting from the use of the DCT applied over the RGB
domain can be quantified if we compare the RD curves considering or
not its use.\footnote{This kind of comparison is commonly called
``\emph{Ablation Study}'' because we are ''removing'' some
functionality of the system to see how its ausence impacts on the
performance.} 

\section{What do I have to do?}

\begin{enumerate}
\item Which redundancies are we exploiting in our image compressor?
\item Please, run the
  \href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/contents/RGB_DCT/RGB_DCT.ipynb}{notebook}
  to learn some insights about the compression of images using the
  DCT.
\item Try to compress different images. Is the Color-DCT always
  effective (are RD curves better than compressing the image in
  the RGB domain)?
\end{enumerate}

\section{Timming}

Please, finish this milestone before the next class session.

\section{Deliverables}

None.

\section{Resources}

\renewcommand{\addcontentsline}[3]{}% Remove functionality of \addcontentsline
\bibliography{maths,data-compression,signal-processing,DWT,image-compression,image-processing}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{comment}
   The steps
of this procedure are (see the
\href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/contents/color_DCT/RGB_DCT.ipynb}{notebook}):
\begin{enumerate}
\item  This fact allows us to use a ``fast'' (with
  linear
  \href{https://en.wikipedia.org/wiki/Computational_complexity}{complexity})
  RDO (Rate/Distortion Optimization) algorithm to find which
  combination of quantization steps $\mathbf{\Delta}$ that
  ``minimizes'' the RD curve of the reconstructed image, which can be
  computed as the sum\footnote{Remember, the constribution of the
  subbands are independent and additive.} of the RD curves generated
  by the $3$ subbands ($\text{DCT}^0$, $\text{DCT}^1$, and
  $\text{DCT}^2$). Therefore, we can:
  \begin{enumerate}
  \item Quantize and compress\footnote{We can consider that the
  coefficients are gray-scale pixels and use a image compressor.} each
    subband with a quantization step $\mathbf{\Delta}_s$. This results
    in $3$ RD curves, one per subband. We define the slope of the
    $n$-th point in a RD curve as the slope of the straight line
    passing through the points $n$ and $n+1$ (see the
    Fig.~\ref{fig:slope_computation}). The slope of the point for the
    highest rate is defined to $0$.  The results generated by this
    step are $3$ RD curves (one per subband).
  \item Put all the RD points in a list, tracking\footnote{Remembering
  the combination subband index and quantization step used for each
  point.} the quantization pattern used for each RD point. Compute the
    list of points of the RD curve of the reconstructed image as the
    (in descending order) sorted list, by slope, of RD points.
  \item (Optional) If the image compressor used in the first step
    generates less data overhead when a color image is compressed
    considering the three channels at the same time, recompute the
    rate of each RD point of the definitive curve. For example, in the
    case of PNG~\cite{vruiz__PNG}, even when the intercomponent
    redundancy is not exploited, the number of headers is decreased if
    we perform only one compression per image.
  \end{enumerate}

  The orthonormality of the DCT also allows us to compute the
  definitive distortion directly in the DCT domain.

  Notice also that this algorithm has been designed considering the
  fact that, ideally (where the RD curve is continuous), the rate
  selected for each subband should be the
  same~\cite{vruiz__information_theory,vetterli2014foundations}, and
  therefore, should generate a RD curve such that the sum of the
  distances of the points of the RD curve to the point $(0,0)$ is
  minimized.
  
\end{enumerate}

As a final remark, take into consideration that the quantization steps
used in each subband should be selected considering aspects such as
the ganularity of the rate-control\footnote{How many points has the RD
curve.} and the features of the decoding process\footnote{For example, if we
want to provide progressive bit-plane decoding, the quantization steps
should be powers of $2$.}

\section{An even faster (but coarser) rate-control algorithm}

The running time of the previous algorithm depends on the number of
subbands, that in our case is only $3$. However, we can develop a
faster rate-control procedure (avoiding to compute the RD curves of
the subbands that is the heaviest part) if we suppose that the RD
slopes are basically determined by the distortion (i.e., without
considering the rate)\footnote{Notice that this basically means that
all the subband's curves have the
same \footnote{https://en.wikipedia.org/wiki/Domain_of_a_function}{domain}
and that the RD points occurs at the same rates}.

Obviously, in the practice it is very unlikely to happen, but if the
shapes of the curves are close enough, we can suppose that the slopes
are the same for the same points in the different curves. In the case
of the DCT that is orthonormal (the gains of the forward and the
backward filters is $1$), this is the same that define the
quantization pattern
\begin{equation}
  \mathbf{\Delta}_0 = \mathbf{\Delta}_1 = \mathbf{\Delta}_2.
\end{equation}

Notice that one way to check if this quantization algorithm is optimal
(for the obtained RD points) is to check if the ``slower'' algorithm
outputs such quantization patterns. If this is true, the ``faster''
rate-control algorithm is optimal, at least for the encoded image.

\end{comment}
