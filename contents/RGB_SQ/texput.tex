% Emacs, this is -*-latex-*-

\input{../../definitions}
\title{\SM{} - Scalar Quantization in the $\text{RGB}$ Color Domain}

\maketitle

\tableofcontents

\section{Objective}
In this task we are going to develop a rudimentery
\href{https://en.wikipedia.org/wiki/Lossy_compression}{lossy
  ($\text{RGB}$) image~\cite{vruiz__image_IO} compressor} based on
scalar quantization~\cite{vruiz__scalar_quantization} and
PNG~\cite{vruiz__PNG}. This compressor removes the number of different
colors in the image
(\href{https://en.wikipedia.org/wiki/Visual_system}{humans} hardly
distinguish more than 64 different colors). We will compare its
RD performance~\cite{vruiz__information_theory} with JPEG.

\section{Distortion control}
Using a deadzone quantizer applied to each channel of the image we are
able to control the number of colors (see the Section
\emph{Distortion control} in the task \emph{Scalar Quantization of
Gray-scale Images}). The quantization steps are
powers of $2$ to simulate a progressive bit-plane encoding.  Notice
that we cannot control the distortion in terms of the RMSE, for
example.

\section{Rate control}
Using PNG we cannot control the rate with accuracy (see the Section
\emph{Rate control} in the task \emph{Scalar Quantization of
Gray-scale Images}). Only $7$ bit-rates are available if we use the
\begin{equation}
  \mathbf{\Delta}_{\text{R}} = \mathbf{\Delta}_{\text{G}} = \mathbf{\Delta}_{\text{B}}
  \label{eq:simple_Q}
\end{equation}
quantization pattern, which from a visual perspective is the only choice if we want to quantize each channel equally (without penalizing one channel against the others).

\section{Increasing the number of RD points}
If the Eq.~\eqref{eq:simple_Q} does not need to be satisfied, we can
increase the accuracy of the rate/distortion control using also the
``intermediate'' points of the bit-plane progressive RD
curve. Therefore, starting for example by the left points of the RD
curve, after each Eq.~\eqref{eq:simple_Q}-point, we must decide which
option is more advantageous: (1) encode the next bit-plane of the
$\text{R}$ channel, (2) encode the next bit-plane of the $\text{G}$
channel, or (3) encode the next bit-plane of the $\text{B}$
channel. We will select the option that provides the highest RD
slope~\cite{vruiz__information_theory}.

\section{Implementation}
The described algorithm has been implemented in this
\href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/contents/RGB_SQ/RGB_SQ.ipynb}{notebook}.

%}}}

\section{What do I have to do?}

\begin{enumerate}
\item Please, run the
  \href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/contents/RGB_quantization/RGB_SQ.ipynb}{notebook}
  to check if the previous theory really works.
\item Try to compress different images.
\end{enumerate}

\section{Timming}

Please, finish this milestone before the next class session.

\section{Deliverables}

None.

\section{Resources}

\renewcommand{\addcontentsline}[3]{}% Remove functionality of \addcontentsline
\bibliography{information_theory,image-formats}


\begin{comment}
  
\section{Scalar quantization in the $\text{RGB}$ domain}

Supposing that we are using a dead-zone quantizer, a $\text{RGB}$
image can be quantized, channel by channel, using quantization steps
$\mathbf{\Delta}_{\text{R}}$, $\mathbf{\Delta}_{\text{G}}$, and
$\mathbf{\Delta}_{\text{B}}$ (being $\mathbf{\Delta}$ the
``quantization pattern''). A reasonable question that arises here is:
given a target bit-rate $R$ for the compressed frame, how the
quantization steps should be chosen to minimize the distortion?

At this point we can consider two different quantization
perspectives. In the first one, if we consider a strictly visual
effect, any alternative different from
\begin{equation}
  \mathbf{\Delta}_{\text{R}} = \mathbf{\Delta}_{\text{G}} = \mathbf{\Delta}_{\text{B}}
  \label{eq:simple_Q}
\end{equation}
will produce some alteration in the color (also called the
\href{https://en.wikipedia.org/wiki/Chrominance}{``chroma''}) of the
reconstructed image.

A second perspective considers only a pure
\href{https://en.wikipedia.org/wiki/Rate-distortion_theory}{Rate/Distortion
  (RD) performance}~\cite{vruiz__information_theory}. The $\text{RGB}$
color domain is additive, which means that the distortion generated in
the quantized image is the sum of the distortions generated in each of
the channels, when they are quantized independently. Therefore, the
optimal RD curve for the reconstructed image (using the $3$ channels)
can be obtained through the steps:
\begin{enumerate}
\item Compute the RD curve for each channel. Notice that here we must
  define a set of quantization steps for each channel. For simplicity,
  use the same set for the three channels.
\item Put all the RD points in a list and sort the list by the slopes
  of the points. Since the points have been ordered by their slope,
  the sequence of quantization patterns should generate the optimal
  curve.
\item Use the corresponding quantization patterns (defined by the points
  of the list) to compute the RD curve of the reconstructed image.
\end{enumerate}

This algorithm is independent of how the set of quantization steps
used in each channel has been selected. If the quantization steps used
to describe the RD curves of each channel are different, the points of
the definitive curve will be different, but not its shape or its
localization in the RD space.

If we are used the same quantization steps for each channel, the
points generated when
\begin{equation}
  \mathbf{\Delta}_{\text{R}} = \mathbf{\Delta}_{\text{G}} = \mathbf{\Delta}_{\text{B}}
\end{equation}
must occur in the definitive RD curve. Notice that the rest of points
of the curve should appear between these points, but do not
necessarily belong to the convex hull of the curve (altough they could
be used to perform a finer rate-control).
\end{comment}
