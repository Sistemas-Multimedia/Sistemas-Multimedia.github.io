% Emacs, this is -*-latex-*-

\input{../../definitions}
\title{\SM{} - \href{https://sistemas-multimedia.github.io/contents/color_transforms}{Color Transforms}}

\maketitle
\tableofcontents

\section{Spectral decorrelation}

Most image and video compressors exploit the statistical (and also
perceptual\footnote{This will be addresed latter in this course.})
correlation between the $\text{RGB}$ color
\emph{components}\footnote{A component of a pixel in the $\text{RGB}$
domain refer to one of the values $\text{R}$ (red), $\text{G}$ (green)
and $\text{B}$ (blue) coordinates in the $\text{RGB}$ color 3D space.}
of the pixels, using a color transform.

Color transforms are pixel-wise operators. As a resul, each pixel is
represented in a different domain where three new
\emph{coefficients}\footnote{Most part of the transforms, including
the color ones, analyze the signal information from a frequency
perspective, generating the so called coefficients whose index in the
transform domain is related to the frequency.} express the
same\footnote{In general, the color transforms can be considered
lossless, although this is only true when fixed-point arithmetic is
used.} information but in a different color domain.

\section{Luma and chromas}

Most color transforms are designed to split the color information of a
pixel in \emph{luminance} (luma) and \emph{chrominance} (chroma). The
luma is basically the low frequency\footnote{It is worth to understand
that the frequency concept in the transform domain is not related to
the frequency concept in the original pixel domain. For example, the
$\text{R}$ component or a pixel represents the amount of red in the
pixel, and in the visible spectrum we are refering to frequencies that
are smaller than $\text{G}$ and $\text{B}$ components. However, in a
color transformed domain, the luma measures brightness level of the
pixel, and we cannot found a subband in the visible spectrum that can
represent such information.} information of the pixel, and the chroma
(logically) the high frequency information.

For example, in JPEG and in H.264/AVC the color information of each
pixel is transformed from the $\text{RGB}$ color space to the
$\text{YCrCb}$ color space, and in JPEG XR, the $\text{YCoCg}$ color
space is used. In these luma-based color spaces, $\text{Y}$ represents
the luma coefficient. The other two form the chroma.

\subsection*{Channels and subbands (a word about notation)}

Apart from using the terms of component and coefficient, we will use
the word \emph{channel} to refeer to the same index component of all
the pixels of an image (or video), and \emph{subband} to denote the
same index coefficient of all the pixels of an image (or video). For
example, the $\text{R}$ channel of a color image corresponds to the
image generated by the $\text{R}$ component of all the pixels of the
image (that can be considered as a
\emph{single-channel}/\emph{mono-component}/\emph{monochromatic}
image), and for example, the $\text{Y}$ subband of a transformed
($\text{RGB}$) image corresponds to the $\text{Y}$ coefficients of
all the pixels (again a ``\emph{scalar}'' image).

Most color transforms map 3 channels ($\text{RGB}$) into 3 subbands.

\section{Benefits of the color transforms}

Color transforms applied to natural visual information generally
provide two main profits:
\begin{enumerate}
\item \textbf{Energy concentration:} In general, transforms ``move''
  the energy (information provided by the signals) between subbands,
  accumulating most of the energy in a reduced number of them (aspect
  related to the so called coding gain of the transform). In our case,
  where the transformations are between color spaces, in the transform
  domain most of the energy is concentrated in the $\text{Y}$
  subband. As a consequence of this, usually, \textbf{the entropy is
    decreased} and the \textbf{the dynamic range is increased}. The
  first means that will compress more, and the second that we will be
  able to use a higher range of quantization step sizes, increasing
  also the number of feasible points in the RD curve.
\item \textbf{Luma/croma analysis:} Our visual system is more
  sensitive in terms of spatial resolution to the luma
  (``black-and-white'') information than to the chroma (``color'')
  information, which basically means that we can quantize more the
  chroma.\footnote{Notice again, that we will study this effect in a
  posterior session.}
\end{enumerate}

\section{Scalar quantization and rate/distortion optimization}

\subsection{In the $\text{RGB}$ domain}

The $\text{RGB}$ components are additive~\cite{burger2016digital} in
both, distortion and rate. Therefore, ideally, given a
target bit-rate or distortion, we should select the quantization step
size in each component that generates the same slope in the RD curve
of the component.

\subsection{In the luma/croma domain}

In this case, the optimal quantization pattern should satisfy the same
conditions as quantizing in the $\text{RGB}$ domain. However, we have
to consider also that the transform must be orthogonal, or at least,
bi-orthogonal (the luma/chroma subbands must be
independent). Otherwise, we cannot say that if we ``improve'' the
quality of one subband in a given amount, such improvement will be
also achieved in the $\text{RGB}$ domain.

\subsection{A easier (and faster) solution}

In general, the RD optimization considering the color domain implies
to know the RD curves of the subbands. If the transform is orthogonal,
this is equivalent to know the RD curves in the $\text{RGB}$ domain
beecause the subbands are additive. If the transform is not
orthogonal, the this last fact is false.

Even if the curves are known, in general a good approximation to the
optimal solution (using scalar quantization) is to use the same
quantization step size for all the subbands. For example, in the
$\text{RGB}$ domain, this implies to use
\begin{equation}
  \mathbf{\Delta}^{\text{R}}_i = \mathbf{\Delta}^{\text{G}}_i =
  \mathbf{\Delta}^{\text{B}}_i,
  \label{eq:simple_Q}
\end{equation}
where $i$ represents the $i$-th quantization step size. Notice that
the quantization pattern defined in the Eq.~\eqref{eq:simple_Q} will
be optimal only if for all the quantization steps, the condition
\begin{equation}
  \mathbf{\lambda}^{\text{R}}_i = \mathbf{\lambda}^{\text{G}}_i =
  \mathbf{\lambda}^{\text{B}}_i
  \label{eq:optimal_lambda}
\end{equation}
is satisfied. In the notebook \href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/contents/RGB_SQ/RGB_SQ.ipynb}{} we can explore (at least, visually) the grade of compilance of
Eq.~\eqref{eq:optimal_lambda}.

\section{Vector quantization of $\text{RGB}$ images}

SQ (Scalar
Quantization)~\cite{vruiz__scalar_quantization,sayood2017introduction}
would be an optimal solution only if the image colors are uniformly
distributed within
\href{https://en.wikipedia.org/wiki/RGB_color_model}{the RGB
  cube}. However, the typical color distribution in natural images is
anything but uniform, with some regions of the color space being
densely populated and many potentially used colors entirely
missing. In this case, depending on the quantization step
size~\cite{vruiz__signal_quantization}, SQ could be suboptimal because
the used colors may not be sampled with suï¬ƒcient density while at the
same time the encoding system is considering colors that do not appear
in the image at all~\cite{burger2016digital}.

On the other hand, VQ (Vector
Quantization)~\cite{vruiz__vector_quantization,sayood2017introduction}
applied to the color domain does not treat the individual $\text{RGB}$
components separately
as does scalar quantization, but each used color vector ${\mathbf C}_i
= ({\mathbf R}_i, {\mathbf G}_i, {\mathbf B}_i )$ in the image is
treated as a minimum structure. VQ determines a code-book of $K$ code-vectors (centroids) that minimizes the distortion between the original image and the reconstructed one. Notice that the code-book must be known by the decoder to make the reconstruction.

\section{To-Do}
\begin{enumerate}
\item Modify VCF to allow the use of the 3-channels DCT in the
  compression pipeline. Complexity 1.
\item Modify VCF to allow the use of the $\text{YCrCb}$ transform in
  the compression pipeline. Complexity 1.
\item Modify VCF to allow the use of Vector Quantization (applied to
  the color domain) in the compression pipeline. Complexity 4.
\end{enumerate}

\section{References}

\renewcommand{\addcontentsline}[3]{}% Remove functionality of \addcontentsline
\bibliography{maths,data_compression,signal_processing,DWT,image_compression,image_processing,information_theory,quantization}
