\input{../../definitions}
\title{\SM{} - Study Guide - Milestone 9: IIII... coding}

\maketitle

\tableofcontents

\section{Description}

\subsection{Intra-coding}

In the previous milestones we have studied how to compress images (or
frames in a sequence of video), performing both a color and a spatial
transformation, and then, using PNG, performing RDO (Rate/Distortion
Optimization). In this milestone we will learn how to perform RDO over
a sequence of frames. Because each frame is encoded independently, we
speak about I (Intra-coded) frames, and III... video coding.

\subsection{Algorithm}

Basically, we are going to:
\begin{enumerate}
\item YCoCg-transform each frame of a GOF (Group Of Frames).
\item DCT each YCoCg component.
\item Build the DCT subbands of each component. For example, for three
  (usually consecutive) frames \verb|A|, \verb|B|, and \verb|C|, and a
  4x4-DCT applied to each frame, we will obtain the decomposition
  (subbands structure):
\begin{verbatim}
   frame A      frame B
+----------+ +----------+
| A0 A1 A2 | | B0 B1 B2 |
| A3 A4 A5 | | B3 B4 B5 |
| A6 A7 A8 | | B6 B7 B8 |
| A9 Aa Ab | | B9 Ba Bb |
+----------+ +----------+
\end{verbatim}

\item Reorder the subbands in the decomposition, generating a single
  2D structure where similar (same frequency) subbands are placed
  together. Continuing with the previous example:
\begin{verbatim}
            frames_per_GOF
              <------->
            ^ +-------+ ^
            | | A0 B0 | |
blocks_in_y | | A3 B3 | |
            | | A6 B6 | |
            | | A9 B9 | |
            v +-------+ |
              | A1 B1 | |
              | A4 B4 | | blocks_in_x*blocks_in_y
              | A7 B7 | |
              | Aa Ba | |
              +-------+ |
              | A2 B2 | |
              | A5 B5 | |
              | A8 B8 | |
              | Ab Bb | |
              +-------+ v
\end{verbatim}
  and it can be seen, the subbands \verb|A0|, \verb|A1|, and
  \verb|A2|, all of them low-frequency subbands are contiguous. This
  should improve the compression ratio provided by PNG.  Notice that
  any other transform that generates subbands (such as the DWT) can be
  used in this stage, although the subbands should be distributed
  considering the descomposition.

\item Find the optimal progression of quantization steps
  combinations. Notice that YCoCg is near orthogonal and DCT is
  orthogonal, and therefore, the optimal progression can be determined
  by simply sorting the RD points by their slope in the transform
  (YCoCg+DCT) domain .

  For example, considering the quantization steps $\{128, 64, 32, 16,
  8, 4, 2, 1\}$, the first combination of quantization steps to test
  could be (the combinations must not be applied in this order):
\begin{verbatim}
+-------------+-------------+-------------+-------------+
| 128 inf inf | inf inf inf | inf inf inf | inf inf inf |
| inf inf inf | inf inf inf | inf inf inf | inf inf inf | 
| inf inf inf | inf inf inf | inf inf inf | inf inf inf | 
| inf inf inf | inf inf inf | inf inf inf | inf inf inf | 
+-------------+-------------+-------------+-------------+
\end{verbatim}
  The second one could be:
\begin{verbatim}
+-------------+-------------+-------------+-------------+
|  64 inf inf | inf inf inf | inf inf inf | inf inf inf |
| inf inf inf | inf inf inf | inf inf inf | inf inf inf | 
| inf inf inf | inf inf inf | inf inf inf | inf inf inf | 
| inf inf inf | inf inf inf | inf inf inf | inf inf inf | 
+-------------+-------------+-------------+-------------+
\end{verbatim}
  And the last one:
\begin{verbatim}
+-------------+-------------+-------------+-------------+
|   1   1   1 |   1   1   1 |   1   1   1 |   1   1   1 |
|   1   1   1 |   1   1   1 |   1   1   1 |   1   1   1 | 
|   1   1   1 |   1   1   1 |   1   1   1 |   1   1   1 | 
|   1   1   1 |   1   1   1 |   1   1   1 |   1   1   1 | 
+-------------+-------------+-------------+-------------+
\end{verbatim}
\end{enumerate}

Notice that we have a total of $3*16=48$ subbands, and the total
number of quantization points is $48*8=384$.

\section{What you have to do?}

Please, create an experiment in which the frame quantization step is
different for each frame of a sequence, and another experiment that
uses the same quantization step for all the frames. Compute the
average RD curves. Which one is better? Do you think that
\begin{equation*}
  D = \sum_i D_i,
\end{equation*}
where $D$ is the distortion generated for the complete sequence and
$D_i$ is the distortion only for the $i$-th frame, holds?

%Try to answer:
%\begin{enumerate}
%\item How many Spatial Resolution Levels (SRL) of
%  $V=\{V_0, V_1, V_2\}$ are accesible from the decomposition of the
%  Fig.~\ref{fig:MDWT} using the $\text{MDWT}^{-1}$?
%\item Please, run the
%  \href{https://sistemas-multimedia.github.io/MRVC/#x1-80004.1}{Example:
%    1-iteration MDWT ($\mathtt{MDWT}(N=5)$)}, and the
%  \href{https://sistemas-multimedia.github.io/MRVC/#x1-90004.2}{Example:
%    2-iterations MDWT ($2\times\mathtt{MDWT}(N=5)$)}.
%\end{enumerate}

\section{Timming}

Please, finish this milestone before the next class session.

\section{Deliverables}

None.

\section{Resources}

\renewcommand{\addcontentsline}[3]{}% Remove functionality of \addcontentsline
\bibliography{JPEG2000}
