\input{../definitions}
\title{\SM{} - Study Guide - Milestone 8: Removing Redundancy with the 2D-DWT}

\maketitle

\section{Description}

(Digital) Images are 2D (2-Dimensional,
\href{https://en.wikipedia.org/wiki/Discrete_time_and_continuous_time}{discrete}
in \href{https://en.wikipedia.org/wiki/Space}{space} and
\href{https://en.wikipedia.org/wiki/Amplitude}{amplitude})
signals. The 2D-DWT of an image can be computed using (1)
\href{https://en.wikipedia.org/wiki/Separable_filter}{separable} 1D
filters, and (2)
\href{https://en.wikipedia.org/wiki/Non-separable_wavelet}{nonseparable}
2D filters.~\cite{sayood2017introduction} Except in very special
cases, all 2D-DWT implementations use separable filters.

Separability in the DWT context means that we can compute the 1-levels
2D-DWT using the 1D filters, simply applying them to each dimension,
and using
\href{https://en.wikipedia.org/wiki/In-place_algorithm}{in-place}
operations. This procedure has been described in the
Algorithms~\ref{alg:Rows-DWT}, \ref{alg:Columns-DWT} and
\ref{alg:2D-DWT}, where $X_{r,*}$ refers to the $r$-th row of the
matrix $X$ and $X_{*,c}$ to the $c$-th column, being $R$ and $C$ the
number of rows and columns of the image $X$.

\begin{pseudocode}{\text{Rows-DWT}}{X}
  \label{alg:Rows-DWT}
  \FOR r \GETS 0 \TO R-1 \DO
  X_{r,*} = \text{DWT}(X_{r,*})\\
  \RETURN{X}
\end{pseudocode}

\begin{pseudocode}{\text{Columns-DWT}}{X}
  \label{alg:Columns-DWT}
  \FOR c \GETS 0 \TO C-1 \DO
  X_{*,c} = \text{DWT}(X_{*,c})\\
  \RETURN{X}
\end{pseudocode}

\begin{pseudocode}{\text{2D-DWT}}{X}
  \label{alg:2D-DWT}
  X = \text{Rows-DWT}(X)\\
  X = \text{Columns-DWT}(X)\\
  \RETURN{X}
  %\FOR r \GETS 0 \TO R-1 \DO
  %X_{r,*} = \text{DWT}(X_{r,*})
  %\\
  %\FOR c \GETS 0 \TO C-1 \DO
  %X_{*,c} = \text{DWT}(X_{*,c})
\end{pseudocode}

\begin{figure}
  \centering
  \begin{tabular}{cccc}
    \vbox{\myfig{graphics/rows_DWT}{2cm}{200}} & \vbox{\myfig{graphics/2D-DWT}{2cm}{200}} & \vbox{\myfig{graphics/n-levels-2D-DWT}{2cm}{200}} & \vbox{\myfig{graphics/resolutions}{2cm}{200}} \\
    (a) & (b) & (c) & (d)
  \end{tabular}
  \caption{Decomposition generated by $\text{2D-DWT}^2(X)$. In the
    Subfig.~(a), the rows of the image has been transformed using the
    1-levels (1D) DWT (this is the output of the
    Alg.~\ref{alg:Rows-DWT}). In the Subfig.~(b), the columns of the
    previously rows-transformed image has been also transformed using
    the 1-levels DWT (this is the output of the
    Alg.~\ref{alg:Columns-DWT}) applied to the previous
    data. Subfig.~(b) is also the output of the Alg.~\ref{alg:2D-DWT}
    applied to the initial image. In the Subfig.~(c) the 1-levels
    2D-DWT has been also applied to the LL$^1$ subband, generating a
    2-levels 2D decomposition. In the Subfig.~(d) a simplified
    representation of Subfig.~(c) has been used, where the different
    spatial resolution levels are highlighted.}
  \label{fig:2D-DWT}
\end{figure}

As it can be seen in the Fig~\ref{fig:2D-DWT}, the obtained 2D decomposition is expressed by
\begin{equation}
  \begin{bmatrix}
    \text{LL} & \text{HL} \\
    \text{LH} & \text{HH}
  \end{bmatrix}
  =
  \text{2D-DWT}(X),
  \label{eq:2D-DWT}
\end{equation}
where $L$ stands for low-pass filtering and $H$ for high-pass
filtering. Notice that $\text{LL}=\text{LL}^1$,
$\text{LH}=\text{LH}^1$, $\text{HL}=\text{HL}^1$, and
$\text{HH}=\text{HH}^1$,

Eq.~\ref{eq:2D-DWT} describes the $1$-levels (analysis)
2D-DWT. Replacing $\text{LL}=L^{s+1}$, $X=L^s$, and
$\{\text{HL}, \text{LH}, \text{HH}\}=H^{s+1}$ in the previous
expression, the $S$-levels 2D-DWT of $L^0=X$ ($\text{2D-DWT}^S(L^0)$)
can be computed applying $S$-times
\begin{equation}
  \{L^{s+1}, H^{s+1}\} = \text{2D-DWT}(L^s)
\end{equation}
to the low-frequency subband $L^s$, generating the 2D decomposition
described in the 

As an example, the Fig.~\ref{fig:lena_2D-DWT} shows the $3$-levels
2D-DWT of the lena image (see this notebook).

\begin{figure}
  \centering
  \begin{tabular}{ccc}
    \vbox{\pngfig{lena}{5cm}{500}} & \vbox{\pngfig{dwt_lena}{5cm}{500}} & \vbox{\pngfig{dwt_lena_normalized}{5cm}{500}}\\
    (a) & (b) & (c)
  \end{tabular}
  \caption{Subfig.~(a): the Lena image. Subfig.~(b):
    $\text{2D-DWT}^3(\text{Lena})$'s decomposition. Subfig.~(c):
    $\text{2D-DWT}^3(\text{Lena})$'s normalized decomposition. See
    \href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/study_guide/06-2D-DWT/dwt_lena.ipynb}{this
      notebook}.}
  \label{fig:lena_2D-DWT}
\end{figure}

\subsection{Multiresolution}
Similarly to the 1D case, a $\text{2D-DWT}^S(\cdot)$ provides $S+1$
spatial resolution levels. An example of this can be seen in the
Subfig.~\ref{fig:2D-DWT}-(d), where there are 3 possible
resolutions. In the Subfig.~\ref{fig:lena_2D-DWT} there are 4
resolutions.

\subsection{Quantization}
The quantization step (see the previous milestone) should be inversely
proportional to the L$_2$ synthesis gain of the subbands\footnote{The
higher the gain, the lower the quantization step, the lower the
quantization noise introduced in the subband, the higher the
contribution of the subband to the reconstruction or the
image.}~\cite{marcellin2002overview}. Most of the DWT's used in image
coding are orthogonal or biorthogonal. In orthogonal transform, all
the subbands have the same gain, but this is not true for biorthogonal
DWTs.

To find the gains we can compute the energy of the signal generated by
the inverse transform of the unitary impulse discrete 2D signal
\begin{equation}
  \delta_{i,j}(x,y) = 
  \left\{
  \begin{array}{ll}
    1 & \text{if $i=x$ and $j=y$}\\
    0 & \text{otherwise},
  \end{array}
  \right.
\end{equation}
where the
\href{https://en.wikipedia.org/wiki/Energy_(signal_processing)}{energy
  of a discrete signal} $x$ is defined as
\begin{equation}
  \langle x, x\rangle =  \sum_{i}{x_i^2}.
\end{equation}

Notice that (see the Fig.~\ref{fig:lena_2D-DWT}) the low-frequency
subbands concentrate more of the energy (and the visual
information). Therefore, these subbands should be quantized less than
the high-frequency subbands. This is exactly what we are doing when we
use a quantization step inversely proportional to the subband gains.

\section{What you have to do?}

\begin{enumerate}
\item Please, using this
  \href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/study_guide/07-DWT/performance.ipynb}{notebook},
  compare the RD performance of using the DWT over the RGB and YCrCb
  domains with the performance of using the DWT over the YCoCg domain.
\item Redo the experiments using a biorthogonal DWT.
\end{enumerate}

\section{Timming}

Please, finish this notebook before the next class session.

\section{Deliverables}

None.

\section{Resources}

\bibliography{data-compression}
