\input{../definitions}
\title{\SM{} - Study Guide - Milestone 5: Energy Concentration and Multiresolution  with the Discrete Wavelet Transform}

\maketitle

\section{Description}

\subsection{Transform coding}

\href{https://web.stanford.edu/class/ee398a/handouts/lectures/07-TransformCoding.pdf}{Transform
  coding} can exploit
\href{https://en.wikipedia.org/wiki/Correlation_and_dependence}{correlation}
in signals to concentrate the energy. Specifically, the DWT (Discrete
Wavelet Transform) is a family of transforms whose output describes
the (input) signal in a set of subbands. This set is also called a
decomposition and the index of the subband is related to the frequency
of the signal. For example, in the case of the images, the position of
the coefficients in the subbands is related to
\href{https://en.wikipedia.org/wiki/Discrete_wavelet_transform#/media/File:Jpeg2000_2-level_wavelet_transform-lichtenstein.png}{the
  spatial area where the related pixels are found}.

All linear\footnote{Non-linear transform are also possible, but their
  mathematical operation can not be described using linear algebra.}
transforms can be described by matrix-vector
product~\cite{strang4linear} as
\begin{equation}
  y = Kx,
  \label{eq:forward_transform_matrix_form}
\end{equation}
where $x$ is the input signal, $K$ is the analysis transform matrix,
and $y$ is the output decomposition. Notice that
\begin{equation}
  y_i = \langle K_i, x_i\rangle,
\end{equation}
where $K_i$ is the $i$-th row of $K$, and $\langle\cdot,\cdot\rangle$
denotes the
\href{https://mathworld.wolfram.com/InnerProduct.html}{inner
  product}. This basically means that $y_i$ is proportional to the
\href{https://en.wikipedia.org/wiki/Similarity_(geometry)}{similarity}
between the input signal $x$ and the
\href{https://en.wikipedia.org/wiki/Finite_impulse_response}{taps} of
the filter $K_i$. These
\href{https://cseweb.ucsd.edu/classes/fa17/cse166-a/lec13.pdf}{slides}
can help you with this key idea. The inverse (synthesis) transform is
computed by
\begin{equation}
  x = K^{-1}y,
  \label{eq:backward_transform_matrix_form}
\end{equation}
where $K^{-1}$ denotes to the inverse matrix of $K$.

For example, the 2x2-KLT is defined by
\begin{equation}
  \begin{bmatrix}
    y_0 \\
    y_1
  \end{bmatrix}
  = 
  \begin{bmatrix} \frac{1}{\sqrt{2}} & \frac{1}{\sqrt{2}} \\ \frac{1}{\sqrt{2}} & \frac{-1}{\sqrt{2}} \end{bmatrix}
  \begin{bmatrix}
    x_0 \\
    x_1
  \end{bmatrix},
  \label{eq:KLT_transform}
\end{equation}
and it hold that
\begin{equation}
  K=K^{-1}=K^{\text T},
  \label{eq:orthogonal_matrix}
\end{equation}
where $K^{\text T}$ represents the transpose matrix of $K$. The
Eq.~\ref{eq:orthogonal_matrix} is true for all orthogonal transforms,
and therefore
\begin{equation}
  \langle K_i, K_j\rangle = 0, \forall i\neq j.
\end{equation}

\subsection{An example of DWT (Discrete Wavelet Transform): Haar DWT}

As the rest of transforms, the DWT is also described by the filters of
$K$. Haar defined the analysis downsampling filters
\begin{equation}
  \begin{bmatrix}
    l^{s+1}_n \\
    h^{s+1}_n
  \end{bmatrix}
  = 
  \begin{bmatrix} \frac{1}{\sqrt{2}} & \frac{1}{\sqrt{2}} \\ \frac{1}{\sqrt{2}} & \frac{-1}{\sqrt{2}} \end{bmatrix}
  \begin{bmatrix}
    l^s_{2n} \\
    l^s_{2n+1}
  \end{bmatrix},
  \label{eq:Haar_transform}
\end{equation}
where the superindex $r$ denotes the resolution level of the signal, and $n$ refeers to the $n$-th element of the signal. By definition (this holds for all DWTs),
\begin{equation}
  l^0=x.
\end{equation}

\begin{figure}
  \centering
  \myfig{haar_filters_response}{6cm}{600}
  \caption{Haar filters response in the frequency domain (see this
    \href{}{notebook}). $|K_i(e^{j\omega})|$ refeers to the
    modulus of the Fourier transform of $K_i$.}
  \label{fig:Haar_filters_response}
\end{figure}

As it can be seen in the Fig.~\ref{fig:Haar_filters_response}, $K_0$
is a low-pass filter and $K_1$ is a high-pass filter (this holds for
all DWTs). We conclude that:
\begin{enumerate}
\item There exists
  \href{https://en.wikipedia.org/wiki/Aliasing}{aliasing} between the
  filters (this holds for all DWTs) and this is a drawback because:
  \begin{enumerate}
  \item The information with the same
    frequency can be found in both subbands ($l$ and $h$). Therefore,
    the concentration of the energy in one of the subbands is
    smaller.
  \item At it can be seen also in Eq.~\ref{eq:Haar_transform}, the
    subbands are downsampled by 2 and both subbands should have, at
    most, a bandwidth of $1/2$ radians/sample in order to avoid the
    aliasing during the subsampling, and increasing thus the
    perceptible quality of the low-pass subband.
  \end{enumerate}
  These problems can be only solved using filters that have
  transfer functions that a overlap a smaller area
  (see Figs.~\ref{} and \ref{}). 
%\item The response of the filter bank is flat, which means that the gain of the different frequencie
%  $|y(e^{j\omega})|=a|x(e^{j\omega})|, a\in\mathbb{R}$ (the
%  reconstructed signal $y$ has not been filtered). % OJO
\item There is not
  \href{https://en.wikipedia.org/wiki/Linear_phase}{phase distortion}
  (the phase of the filters is a linear function of the
  frequency). This means that coefficients $l^{s+1}_n$ and $h^{s+1}_n$
  refeers to the section of signal $\{l^s_{2n}, l^s_{2n+1}\}$,
  allowing the design of entropy codecs for the decomposition which
  exploit the correlation between subbands. Notice that this does not
  hold for all filters (see Figs.~\ref{} and \ref{}).
\end{enumerate}

% Polyphase implementation of the multilevel DWT

Eq.~\ref{eq:Haar_transform} computes the 1-levels Haar DWT. In
general, the $S$-levels DWT is computed by the recursive use of
Eq.~\ref{eq:Haar_transform} to the low-frequency subband, defining
(this holds for all DWTs)
\begin{equation}
  \{l^{s+1}, h^{s+1}\} = \text{DWT}(l^s).
  \label{eq:DWT}
\end{equation}
Notice that when Eq.~\ref{eq:DWT} is applied recursively to $l^0$ $S$
times, the following decomposition
  \begin{equation}
    | l^S_0 | h^S_0 | h^{S-1}_0 h^{S-1}_1 | h^{S-2}_0 h^{S-2}_1 h^{S-2}_2 h^{S-2}_3 | \cdots | h^1_0 h^1_1 \cdots h^1_{2^{n-1}-1} |,
  \end{equation}
  is obtained. Notice that in this decomposition there are $S+1$
  subbands.

The $R$-levels inverse DWT is defined by (this holds for all DWTs)
\begin{equation}
  l^s = \text{iDWT}(\{l^{s+1}, h^{s+1}\}),
\end{equation}
where, in the case of the Haar DWT, iDWT is the result of solving
$l^{s+1}$ and $h^{s+1}$ in the Eq.~\ref{eq:Haar_transform}.

\subsection{Orthogonal and biorthogonal DWT}
In the DWT context, orthogonality provides intersubband decorrelation,
which basically means that the contribution of each subbands to the
reconstruction (this holds for all DWTs) of the signal are
independent. Using a similar notation that the followed by PyWavelets,
all transforms are defined by 4 filters:
\begin{enumerate}
\item Analysis (downsampling) low-pass filter $\tilde\phi$ (the decomposition
  scaling function), which computes $l^{s+1}$ from $l^s$.
\item Analysis (downsampling) high-pass filter $\tilde\psi$ (the decomposition
  wavelet function), which computes $h^{s+1}$ frin $l^s$.
\item Synthesis (upsampling) high-pass filter $\phi$ (the
  reconstruction scaling function), which computes $\{l^s_{2n}\}$ from
  $l^{s+1}$ and $h^{s+1}$.
\item Synthesis (upsampling) high-pass filter $\psi$ (the
  reconstruection wavelet function), which computes $\{l^s_{2n+1}\}$
  from $l^{s+1}$ and $h^{s+1}$.
\end{enumerate}

Orthogonal filters can be recognized because:
\begin{enumerate}
\item $\tilde\phi\bot\tilde\psi$ and $\phi\bot\psi$.
\item Their taps are all different (asymmetric).
\item The synthesis filters can be determined simply by
  \emph{reflecting} analysis filters.
\item In general, except for the Haar filters, orthogonal filters
  generate phase distortion.
\end{enumerate}

On the other hand, in a biorthogonal DWT:
\begin{enumerate}
\item $\tilde\phi\bot\tilde\psi$, $\phi\bot\psi$, $\psi\bot\tilde\phi$
  and $\tilde\psi\bot\phi$.
\item The all filters are symmetric.
\item $\psi=(-1)^n\tilde\phi; n\in\mathbb{N}$, and
  $\phi=(-1)^n; n\in\mathbb{N}$ (the odd taps are multiplied by $-1$).
\item No phase distortion.
\end{enumerate}

\section{What you have to do?}
  
Please, complete this
\href{https://github.com/Sistemas-Multimedia/Sistemas-Multimedia.github.io/blob/master/study_guide/MDWT/MDWT.ipynb}{notebook}.

\section{Timming}

Please, finish this notebook before the next class session.

\section{Deliverables}

None.

\section{Resources}

\bibliography{python}
